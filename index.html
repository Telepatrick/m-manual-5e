<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<link rel="import" href="src/top-stats.html">
    <link rel="import" href="src/creature-heading.html">
    <link rel="import" href="src/abilities-block.html">
    <link rel="import" href="src/property-block.html">
    <link rel="import" href="src/property-line.html">
    <link rel="import" href="src/stat-block.html">
    <style>
      body {
        margin: 0;
      }

      stat-block {
        /* A bit of margin for presentation purposes, to show off the drop
        shadow. */
        margin-left: 20px;
        margin-top: 20px;
      }
    </style>
</head>
<body>
<div class="container">
  <h2>DnD 5e Monster Manual</h2>
  <p><strong>Note:</strong> Start <strong>searching monster</strong> typing his name in field below.</p>
<div id="searcharea">
		<h2>Live Search</h2>
		<input type="search" id="search"/>
	</div>
<div class="panel-group" id="monsters">
</div>
	<script type="text/javascript">
	$('#search').keypress(function(event) {//when key is pressed in search bar
        if (event.keyCode == 13) {
            var searchTerm = $(this).val(); //val of search bar
            var myExp = new RegExp(searchTerm, "i"); //regular experation

            $.getJSON('hunklessons.json', function (data) {//get the json file
            }).done(function (data) {
                var output = "<div class='panel panel-default'>";
                $.each(data.compendium.monster, function (key, val) {
                    if (val.name.search(myExp) != -1) {//search for the data in the json file
                        output += "<stat-block>";
                        output += "<div class='panel-heading'>";
                        output += "<creature-heading>";
                        output += "<h1 class='panel-title'>";
                        output += '<a data-toggle="collapse" data-parent="#monsters" href="#collapse' + key + '">' + val.name + '</a>';
                        output += '</h1><h2>' + val.type + ', CR ' + val.cr + '</h2>';
                        output += "</creature-heading>";
                        output += '</div>';
                        output += '<div id="collapse' + key + '" class ="panel-collapse collapse">';
                        output += '<div class="panel-body">';
                        output += '<top-stats>';
                        output += '<property-line>';
                        output += '<h4>Armor Class </h4><p>' + val.ac + '</p>';
                        output += '</property-line>';
                        output += '<property-line>';
                        output += '<h4>Hit Points </h4><p>' + val.hp + '</p>';
                        output += '</property-line>';
                        output += '<property-line>';
                        output += '<h4>Speed </h4><p>' + val.speed + '</p>';
                        output += '</property-line>';
                        output += '<abilities-block data-str="' + val.str + '" data-dex="' + val.dex + '" data-con="' + val.con + '" data-int="' + val.int + '" data-wis="' + val.wis + '" data-cha="' + val.cha + '"></abilities-block>';
                        output += '<property-line><h4>Damage Immunities </h4><p>' + val.immune + '</p></property-line>';
                        output += '<property-line><h4>Condition Immunities </h4><p>' + val.conditionImmune + '</p></property-line>';
                        output += '<property-line><h4>Senses </h4><p>' + val.senses + '</p></property-line>';
                        output += '<property-line><h4>Languages </h4><p>' + val.languages + '</p></property-line>';
                        output += '<property-line><h4>Challenge </h4><p>' + val.cr + '</p></property-line>';
                        output += '</top-stats>';
                        if (Array.isArray(val.trait)) {
                            $.each(val.trait, function (i, t) {
                                output += '<property-block><h4>' + t.name + ' </h4><p>' + t.text + '</p>';
                                output += '</property-block>';
                            });
                        }else if(typeof val.trait === 'object') {
                            $.each(val.trait, function (i, t) {
                                output += '<property-block><p>' + t + '</p>';
                                output += '</property-block>';
                            });
                        }
                        if (Array.isArray(val.action)) {
                            output += '<h3>Actions</h3>';
                            $.each(val.action, function (i, t) {
                                output += '<property-block><h4>' + t.name + ' </h4><p>' + t.text + '</p>';
                                output += '</property-block>';
                            });
                        }else if(typeof val.action === 'object') {
                            $.each(val.action, function (i, t) {
                                output += '<property-block><p>' + t + '</p>';
                                output += '</property-block>';
                            });
                        }
                        output += "</div>";
                        output += '</div>';
                        output += "</stat-block>";
                    }
                });//end each
                output += "</div>";
                $('#monsters').html(output);//output result to the update div
            });
        }
    });
	</script>
</div>
</body>
</html>

