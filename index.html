<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<link rel="import" href="statblock5e/src/top-stats.html">
    <link rel="import" href="statblock5e/src/creature-heading.html">
    <link rel="import" href="statblock5e/src/abilities-block.html">
    <link rel="import" href="statblock5e/src/property-block.html">
    <link rel="import" href="statblock5e/src/property-line.html">
    <link rel="import" href="statblock5e/src/stat-block.html">
    <style>
      body {
        margin: 0;
      }

      stat-block {
        /* A bit of margin for presentation purposes, to show off the drop
        shadow. */
        margin-left: 20px;
        margin-top: 20px;
      }
    </style>
</head>
<body>
<div class="container">
  <h2>DnD 5e Monster Manual</h2>
  <p><strong>Note:</strong> Start <strong>searching monster</strong> typing his name in field below.</p>
<div id="searcharea">
		<h2>Live Search</h2>
		<input type="search" id="search"/>
	</div>
<div class="panel-group" id="monsters">
</div>
<script type="text/javascript">
function getExpVal(expVal) {
    var exp = '0';
    switch (expVal) {
        case '0':
            exp = Math.floor(Math.random() * 10) + 1;
            break;
        case '1/8':
            exp = '25';
            break;
        case '1/4':
            exp = '50';
            break;
        case '1/2':
            exp = '100';
            break;
        case '1':
            exp = '200';
            break;
        case '2':
            exp = '450';
            break;
        case '3':
            exp = '700';
            break;
        case '4':
            exp = '1100';
            break;
        case '5':
            exp = '1800';
            break;
        case '6':
            exp = '2300';
            break;
        case '7':
            exp = '2900';
            break;
        case '8':
            exp = '3900';
            break;
        case '9':
            exp = '5000';
            break;
        case '10':
            exp = '5900';
            break;
        case '11':
            exp = '7200';
            break;
        case '12':
            exp = '8400';
            break;
        case '13':
            exp = '10000';
            break;
        case '14':
            exp = '11500';
            break;
        case '15':
            exp = '13000';
            break;
        case '16':
            exp = '15000';
            break;
        case '17':
            exp = '18000';
            break;
        case '18':
            exp = '20000';
            break;
        case '19':
            exp = '22000';
            break;
        case '20':
            exp = '25000';
            break;
        case '21':
            exp = '33000';
            break;
        case '22':
            exp = '41000';
            break;
        case '23':
            exp = '50000';
            break;
        case '24':
            exp = '62000';
            break;
        case '25':
            exp = '-';
            break;
        case '26':
            exp = '-';
            break;
        case '30':
            exp = '155000';
            break;
        default:
            exp = '';
    }

    return exp + ' exp';
}
$('#search').keypress(function(event) {//when key is pressed in search bar
    if (event.keyCode == 13) {
        var searchTerm = $(this).val(); //val of search bar
        var myExp = new RegExp(searchTerm, "i"); //regular experation

        $.getJSON('data/compendium.json', function (data) {//get the json file
        }).done(function (data) {
            var output = "";
            $.each(data.compendium.monster, function (key, mnstr) {
                if (mnstr.name.search(myExp) != -1) {//search for the data in the json file
                    output += "<stat-block>";
                    output += "<div class='panel-heading'>";
                    output += "<creature-heading>";
                    output += "<h1 class='panel-title'>";
                    output += '<a data-toggle="collapse" data-parent="#monsters" href="#collapse' + key + '">' + mnstr.name + '</a>';
                    output += '</h1><h2>' + mnstr.type + ', CR ' + mnstr.cr + ' ('+ getExpVal(mnstr.cr) +')'+ '</h2>';
                    output += "</creature-heading>";
                    output += '</div>';
                    output += '<div id="collapse' + key + '" class ="panel-collapse collapse">';
                    output += '<div class="panel-body">';
                    output += '<top-stats>';
                    output += '<property-line><h4>Armor Class </h4><p>' + mnstr.ac + '</p></property-line>';
                    output += '<property-line><h4>Hit Points </h4><p>' + mnstr.hp + '</p></property-line>';
                    output += '<property-line><h4>Speed </h4><p>' + mnstr.speed + '</p></property-line>';
                    output += '<abilities-block data-str="' + mnstr.str + '" data-dex="' + mnstr.dex + '" data-con="' + mnstr.con + '" data-int="' + mnstr.int + '" data-wis="' + mnstr.wis + '" data-cha="' + mnstr.cha + '"></abilities-block>';
                    if (mnstr.skill)
                    output += '<property-line><h4>Skills </h4><p>' + mnstr.skill + '</p></property-line>';
                    output += '<property-line><h4>Passive Perception </h4><p>' + mnstr.passive + '</p></property-line>';
                    if (mnstr.immune)
                    output += '<property-line><h4>Damage Immunities </h4><p>' + mnstr.immune + '</p></property-line>';
                    if (mnstr.conditionImmune)
                    output += '<property-line><h4>Condition Immunities </h4><p>' + mnstr.conditionImmune + '</p></property-line>';
                    if (mnstr.senses)
                    output += '<property-line><h4>Senses </h4><p>' + mnstr.senses + '</p></property-line>';
                    output += '<property-line><h4>Languages </h4><p>' + mnstr.languages + '</p></property-line>';
                    output += '<property-line><h4>Challenge </h4><p>' + mnstr.cr + '</p></property-line>';
                    output += '</top-stats>';
                    if (Array.isArray(mnstr.trait)) {
                        $.each(mnstr.trait, function (i, t) {
                            output += '<property-block><h4>' + t.name + ' </h4><p>' + t.text + '</p>';
                            output += '</property-block>';
                        });
                    }else if(typeof mnstr.trait === 'object') {
                        $.each(mnstr.trait, function (i, t) {
                            if(i === 'name')
                                output += '<property-block><h4>' + t + '</h4>';
                            else
                                output += '<property-block><p>' + t + '</p>';
                            output += '</property-block>';
                        });
                    }
                    if (Array.isArray(mnstr.action)) {
                        output += '<h3>Actions</h3>';
                        $.each(mnstr.action, function (i, t) {
                            output += '<property-block><h4>' + t.name + ' </h4><p>' + t.text + '</p>';
                            output += '</property-block>';
                        });
                    }else if(typeof mnstr.action === 'object') {
                        $.each(mnstr.action, function (i, t) {
                            if(i === 'name')
                                output += '<property-block><h4>' + t + '</h4>';
                            else
                                output += '<property-block><p>' + t + '</p>';
                        });
                    }
                    if (mnstr.legendary) {
                        output += '<h3>Legendary</h3>';
                        $.each(mnstr.legendary, function (i, l) {
                            output += '<property-block><h4>' + l.name + ' </h4><p>' + l.text + '</p>';
                            output += '</property-block>';
                        });
                    }
                    output += "</div>";
                    output += '</div>';
                    output += "</stat-block>";
                }
            });//end each
            $('#monsters').html(output);//output result to the update div
        });
    }
});
</script>
</div>
</body>
</html>

